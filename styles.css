/* ==========================================================================
   1. Base Styles & Variables
   ========================================================================== */

:root {
    /* Color Palette */
    --primary-color: #4CAF50;
    --accent-color: #3498db;
    --danger-color: #f44336;
    --warning-color: #ff9800;
    --info-color: #2196F3;

    /* Light Theme Variables */
    --bg-primary-light: #f4f7f9; /* Slightly softer white */
    --bg-secondary-light: #ffffff;
    --text-primary-light: #2c3e50; /* Darker, less harsh black */
    --text-secondary-light: #7f8c8d; /* Muted secondary text */
    --border-color-light: #e0e6ed; /* Softer border */
    --shadow-color-light: rgba(44, 62, 80, 0.1); /* Shadow based on primary text */
    --gradient-start-light: rgba(106, 17, 203, 0.03);
    --gradient-end-light: rgba(37, 117, 252, 0.04);
    --hover-bg-light: rgba(44, 62, 80, 0.05);
    --accent-color-rgb-light: 52, 152, 219; /* RGB for accent */
    --bg-secondary-rgb-light: 255, 255, 255;


    /* Dark Theme Variables */
    --bg-primary-dark: #1a1d21; /* Dark blue/grey */
    --bg-secondary-dark: #282c34; /* Slightly lighter card background */
    --text-primary-dark: #e6edf3; /* Off-white text */
    --text-secondary-dark: #95a0ac; /* Lighter secondary text */
    --border-color-dark: #3c424d; /* Softer dark border */
    --shadow-color-dark: rgba(0, 0, 0, 0.2); /* Darker shadow base */
    --gradient-start-dark: rgba(106, 17, 203, 0.08);
    --gradient-end-dark: rgba(37, 117, 252, 0.08);
    --hover-bg-dark: rgba(255, 255, 255, 0.08);
    --accent-color-dark: #4ecdc4; /* Teal accent for dark mode */
    --accent-color-rgb-dark: 78, 205, 196; /* RGB for dark accent */
    --bg-secondary-rgb-dark: 40, 44, 52;


    /* Default Theme Assignment (Light) */
    --bg-primary: var(--bg-primary-light);
    --bg-secondary: var(--bg-secondary-light);
    --text-primary: var(--text-primary-light);
    --text-secondary: var(--text-secondary-light);
    --border-color: var(--border-color-light);
    --shadow-color: var(--shadow-color-light);
    --gradient-start: var(--gradient-start-light);
    --gradient-end: var(--gradient-end-light);
    --hover-bg: var(--hover-bg-light);
    --accent-current: var(--accent-color);
    --accent-current-rgb: var(--accent-color-rgb-light);
    --bg-secondary-rgb: var(--bg-secondary-rgb-light);

    /* Layout & Sizing */
    --container-max-width: 1200px;
    --content-max-width: 1080px;
    --base-padding: 16px; /* Consistent padding unit */
    --large-padding: 24px;
    --base-gap: 20px;
    --small-gap: 10px;

    /* Borders & Shadows */
    --border-radius-small: 6px;
    --border-radius-medium: 10px;
    --border-radius-large: 24px;
    --border-radius-round: 50%;
    --shadow-small: 0 2px 5px var(--shadow-color); /* Subtler small shadow */
    --shadow-medium: 0 6px 12px var(--shadow-color);
    --shadow-large: 0 10px 25px var(--shadow-color);

    /* Transitions */
    --transition-speed-fast: 0.15s;
    --transition-speed-normal: 0.25s;
    --transition-speed-slow: 0.4s;
    --transition-main: all var(--transition-speed-normal) ease-in-out; /* Smoother ease */
    --transition-bg: background-color var(--transition-speed-normal) ease-in-out, color var(--transition-speed-normal) ease-in-out;

    /* Z-Indexes */
    --z-overlay: 1;
    --z-content: 10;
    --z-card-hover: 11; /* For hovered cards */
    --z-modal-backdrop: 1000;
    --z-modal-content: 1001;
    --z-settings-panel: 1100;
    --z-settings-toggle: 1101;
}

/* Apply Dark Theme Variables */
body.dark-theme {
    --bg-primary: var(--bg-primary-dark);
    --bg-secondary: var(--bg-secondary-dark);
    --text-primary: var(--text-primary-dark);
    --text-secondary: var(--text-secondary-dark);
    --border-color: var(--border-color-dark);
    --shadow-color: var(--shadow-color-dark);
    --gradient-start: var(--gradient-start-dark);
    --gradient-end: var(--gradient-end-dark);
    --hover-bg: var(--hover-bg-dark);
    --accent-current: var(--accent-color-dark);
    --accent-current-rgb: var(--accent-color-rgb-dark);
    --bg-secondary-rgb: var(--bg-secondary-rgb-dark);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; /* System font stack */
    line-height: 1.6;
    background-color: var(--bg-primary);
    background-image: var(--bg-image, linear-gradient(135deg, var(--gradient-end), var(--gradient-start)));
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    color: var(--text-primary);
    transition: background var(--transition-speed-slow) ease, color var(--transition-speed-normal) ease;
    padding-top: var(--large-padding); /* Add some space at the top */
}

/* Subtle overlay shown only when a background image is set (via JS) */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.06);
    pointer-events: none;
    z-index: var(--z-overlay);
    opacity: var(--bg-image-set, 0); /* Controlled by JS: --bg-image-set: 1; */
    transition: opacity var(--transition-speed-normal) ease;
}
body.dark-theme::before { background-color: rgba(0, 0, 0, 0.25); }

/* ==========================================================================
   2. Layout Containers
   ========================================================================== */

.container {
    width: 100%;
    max-width: var(--container-max-width);
    padding: 0 var(--large-padding) var(--large-padding); /* Adjust container padding */
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

/* ==========================================================================
   3. Header & Clock (Centered Above Search)
   ========================================================================== */

.header {
    text-align: center;
    margin-bottom: var(--large-padding);
    width: auto;
    align-self: center;
}
.time-date { text-align: center; }
.clock { font-size: 2.8rem; font-weight: 300; line-height: 1.1; }
.date { font-size: 1rem; opacity: 0.7; margin-top: -3px; color: var(--text-secondary); }

/* ==========================================================================
   4. Search Section
   ========================================================================== */

.search-container {
    display: flex;
    flex-direction: column;
    gap: var(--base-padding);
    margin-bottom: calc(var(--large-padding) * 1.5);
    width: 100%;
    max-width: 650px; /* Adjust max width */
    align-self: center;
    /* Optional background/blur effect */
    /* background-color: rgba(var(--bg-secondary-rgb), 0.6);
    backdrop-filter: blur(4px);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-large);
    padding: var(--base-padding); */
}

.search-wrapper { position: relative; display: flex; }
.search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); opacity: 0.6; pointer-events: none; font-size: 1.1em; }

#google-search, #bookmark-search, #wiki-search {
    width: 100%;
    padding: 14px var(--large-padding) 14px 50px; /* Increased padding */
    font-size: 1rem;
    border: 1px solid var(--border-color); /* Thinner border */
    border-radius: var(--border-radius-large);
    outline: none;
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    box-shadow: var(--shadow-small);
    transition: var(--transition-main);
    appearance: none; /* Remove default search input styling */
}
#google-search::placeholder, #bookmark-search::placeholder, #wiki-search::placeholder { color: var(--text-secondary); opacity: 0.8;}

#google-search:focus, #bookmark-search:focus, #wiki-search:focus {
    box-shadow: 0 0 0 3px rgba(var(--accent-current-rgb), 0.3), var(--shadow-medium); /* Glow effect + shadow */
    border-color: var(--accent-current);
}

/* ==========================================================================
   5. Section Titles
   ========================================================================== */

.section-title {
    margin: var(--large-padding) 0 var(--base-padding);
    font-size: 1.1rem;
    color: var(--text-secondary);
    font-weight: 600;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--small-gap);
}
.section-title i { color: var(--accent-current); font-size: 1.1em; }

/* ==========================================================================
   6. Link & Bookmark Grids
   ========================================================================== */

.quick-links, .bookmarks-container {
    display: grid; /* Use Grid for potentially better alignment */
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); /* Responsive columns */
    gap: var(--base-gap);
    width: 100%;
    max-width: var(--content-max-width);
    align-self: center;
    margin-bottom: var(--large-padding);
}

/* ==========================================================================
   7. Link Card Styles (Updated)
   ========================================================================== */

.link-card {
    background-color: var(--bg-secondary);
    border-radius: var(--border-radius-medium);
    padding: var(--base-padding);
    /* width/height set by grid */
    aspect-ratio: 1 / 1; /* Make cards square */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: var(--shadow-small);
    border: 1px solid var(--border-color);
    transition: var(--transition-main), box-shadow var(--transition-speed-normal) ease-in-out; /* Separate shadow transition */
    cursor: pointer;
    position: relative;
    overflow: hidden;
    color: var(--text-primary);
}

.link-card:hover, .link-card:focus-within {
    transform: translateY(-4px) scale(1.03);
    box-shadow: var(--shadow-medium), 0 0 15px rgba(var(--accent-current-rgb), 0.1); /* Combined shadow + subtle glow */
    border-color: var(--accent-current);
    z-index: var(--z-card-hover);
}
.link-card:focus-visible { /* Explicit keyboard focus */
    outline: 2px solid var(--accent-current);
    outline-offset: 3px;
    box-shadow: var(--shadow-medium), 0 0 15px rgba(var(--accent-current-rgb), 0.1);
}

.link-card .card-content { /* Wrapper for icon/text if needed */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    overflow: hidden;
}

.link-card img.favicon {
    width: 40px;
    height: 40px;
    min-height: 40px; /* Prevent squashing */
    margin-bottom: var(--small-gap);
    border-radius: var(--border-radius-round);
    object-fit: contain;
    background-color: rgba(128, 128, 128, 0.05);
    border: 1px solid var(--border-color);
    padding: 2px; /* Small padding inside border */
}

.link-card p.link-name {
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.8rem; /* Smaller text */
    width: 95%; /* Ensure ellipsis works, prevent touching edges */
    color: var(--text-primary);
    line-height: 1.3;
}

/* Distinct Add Card Styling */
.add-link-card {
    background: none;
    border: 2px dashed var(--border-color);
    color: var(--text-secondary);
    box-shadow: none;
    justify-content: center;
}
.add-link-card:hover, .add-link-card:focus, .add-link-card:focus-visible {
    background-color: var(--hover-bg);
    border-style: solid;
    border-color: var(--accent-current);
    color: var(--accent-current);
    transform: translateY(-4px); /* Consistent lift */
    box-shadow: var(--shadow-small); /* Add shadow on hover */
}
.add-link-card .add-icon { font-size: 1.8rem; line-height: 1; margin-bottom: 5px; }
.add-link-card p { font-size: 0.8rem; white-space: normal; }

/* Edit/Delete Buttons */
.card-controls { position: absolute; top: 5px; right: 5px; display: flex; gap: 5px; opacity: 0; pointer-events: none; transition: opacity var(--transition-speed-fast) ease; z-index: var(--z-content); }
.link-card:hover .card-controls, .link-card:focus-within .card-controls { opacity: 1; pointer-events: auto; }

.edit-btn, .delete-btn { background-color: rgba(var(--bg-secondary-rgb), 0.7); backdrop-filter: blur(2px); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: var(--border-radius-round); width: 24px; height: 24px; font-size: 0.75rem; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all var(--transition-speed-fast) ease; padding: 0; line-height: 1; }
.edit-btn:hover, .edit-btn:focus { background-color: var(--info-color); color: white; border-color: var(--info-color); }
.delete-btn:hover, .delete-btn:focus { background-color: var(--danger-color); color: white; border-color: var(--danger-color); }

/* Dragging State */
.link-card.dragging { opacity: 0.5; transform: scale(1.05); cursor: grabbing; box-shadow: var(--shadow-large); z-index: var(--z-modal-backdrop); }
.link-card:not(.add-link-card):not(.dragging) { cursor: grab; }

/* ==========================================================================
   8. Settings Panel & Toggle (Updated Structure)
   ========================================================================== */

.settings-toggle { position: fixed; bottom: var(--large-padding); right: var(--large-padding); background-color: var(--bg-secondary); color: var(--text-secondary); border-radius: var(--border-radius-round); width: 48px; height: 48px; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: var(--shadow-medium); z-index: var(--z-settings-toggle); font-size: 1.5rem; transition: var(--transition-main); border: 1px solid var(--border-color); }
.settings-toggle:hover, .settings-toggle.active { transform: rotate(90deg) scale(1.1); color: var(--accent-current); box-shadow: var(--shadow-large); }

#background-settings { position: fixed; bottom: calc(var(--large-padding) * 2 + 52px); right: var(--large-padding); background-color: var(--bg-secondary); border-radius: var(--border-radius-medium); padding: var(--base-padding); box-shadow: var(--shadow-large); z-index: var(--z-settings-panel); display: flex; flex-direction: column; gap: 0; /* Remove main gap, use group margin */ min-width: 280px; transition: transform var(--transition-speed-normal) ease-in-out, opacity var(--transition-speed-normal) ease-in-out; transform: translateY(15px); opacity: 0; pointer-events: none; border: 1px solid var(--border-color); }
#background-settings:not(.hidden) { transform: translateY(0); opacity: 1; pointer-events: auto; }

.settings-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: var(--small-gap); margin-bottom: var(--base-padding); border-bottom: 1px solid var(--border-color); }
.settings-header h3 { margin: 0; font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: var(--small-gap); }

.setting-group { margin-bottom: var(--base-padding); }
.setting-group:last-child { margin-bottom: 0; }
.setting-group-title { font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: var(--small-gap); }

.setting-item { display: flex; flex-direction: column; gap: calc(var(--small-gap) / 2); margin-bottom: var(--base-padding); }
.setting-item:last-child { margin-bottom: 0; }

.setting-item label, .theme-toggle label { font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); }
.setting-item .input-group { display: flex; gap: 5px; } /* For background input+btn */
.setting-item input[type="text"], .setting-item input[type="url"] { flex-grow: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius-small); background-color: var(--bg-primary); color: var(--text-primary); font-size: 0.9rem; }
.setting-item input:focus { outline: none; border-color: var(--accent-current); box-shadow: 0 0 0 2px rgba(var(--accent-current-rgb), 0.2); }
.setting-item .btn { padding: 8px 12px; font-size: 0.9rem; flex-shrink: 0; /* Prevent button shrinking */ }

.setting-item select.wallpaper-select { /* Style the new select */
    width: 100%;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-small);
    background-color: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.9rem;
    cursor: pointer;
    appearance: none; /* Basic reset */
    background-image: /* Add a dropdown arrow */
        linear-gradient(45deg, transparent 50%, currentColor 50%),
        linear-gradient(135deg, currentColor 50%, transparent 50%);
    background-position:
        calc(100% - 20px) calc(1em + 2px),
        calc(100% - 15px) calc(1em + 2px);
    background-size: 5px 5px, 5px 5px;
    background-repeat: no-repeat;
    padding-right: 35px; /* Make space for arrow */
}
.setting-item select.wallpaper-select:focus {
    outline: none;
    border-color: var(--accent-current);
    box-shadow: 0 0 0 2px rgba(var(--accent-current-rgb), 0.2);
}

/* Add some spacing between background control items if needed */
.setting-item.background-control + .setting-item.background-control {
    margin-top: var(--small-gap);
}

.theme-toggle { flex-direction: row; justify-content: space-between; align-items: center; margin-bottom: var(--base-padding); }
.theme-switch { cursor: pointer; /* Add styles for your specific switch component */ }

#background-settings hr { border: none; height: 1px; background-color: var(--border-color); margin: var(--base-padding) calc(var(--base-padding) * -1); /* Extend full width */ }

.import-export-controls { display: flex; gap: var(--small-gap); }
.import-export-controls .btn { flex: 1; font-size: 0.85rem; padding: 8px 10px; }

/* ==========================================================================
   9. Modal Styles (Updated)
   ========================================================================== */

.modal { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.65); display: flex; justify-content: center; align-items: center; z-index: var(--z-modal-backdrop); padding: var(--large-padding); opacity: 0; pointer-events: none; transition: opacity var(--transition-speed-normal) ease; }
.modal:not(.hidden) { opacity: 1; pointer-events: auto; }

.modal-content { background-color: var(--bg-secondary); border-radius: var(--border-radius-medium); padding: var(--large-padding); width: 100%; max-width: 420px; box-shadow: var(--shadow-large); z-index: var(--z-modal-content); transform: scale(0.95) translateY(10px); transition: transform var(--transition-speed-normal) ease-in-out; border: 1px solid var(--border-color); }
.modal:not(.hidden) .modal-content { transform: scale(1) translateY(0); }

.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--base-padding); }
.modal-content h2 { margin: 0; font-size: 1.25rem; color: var(--text-primary); display: flex; align-items: center; gap: var(--small-gap); }
.modal-close-btn { /* Position close button if using one in header */ }

.form-group { margin-bottom: var(--base-padding); }
.form-group label { display: flex; align-items: center; gap: calc(var(--small-gap) / 2); margin-bottom: calc(var(--small-gap) / 2); font-weight: 600; font-size: 0.9rem; color: var(--text-secondary); }
.form-group label i { width: 16px; text-align: center; }
.form-group input[type="text"], .form-group input[type="url"] { width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius-small); font-size: 1rem; background-color: var(--bg-primary); color: var(--text-primary); transition: border-color var(--transition-speed-fast) ease, box-shadow var(--transition-speed-fast) ease; }
.form-group input:focus { outline: none; border-color: var(--accent-current); box-shadow: 0 0 0 3px rgba(var(--accent-current-rgb), 0.2); }

.modal-actions { display: flex; justify-content: flex-end; gap: var(--small-gap); margin-top: var(--large-padding); border-top: 1px solid var(--border-color); padding-top: var(--base-padding); }

/* ==========================================================================
   10. Buttons
   ========================================================================== */

.btn { padding: 9px 18px; /* Slightly adjusted padding */ border: none; border-radius: var(--border-radius-small); cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all var(--transition-speed-fast) ease-in-out; display: inline-flex; align-items: center; justify-content: center; gap: calc(var(--small-gap) / 1.5); text-decoration: none; line-height: 1.4; }
.btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
.btn:active { transform: translateY(0); filter: brightness(1); }
.btn i { font-size: 1em; /* Icon size relative to button text */ margin-right: 2px; /* Adjust spacing */ }

.btn-primary { background-color: var(--primary-color); color: #ffffff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.btn-primary:hover { background-color: hsl(from var(--primary-color) h s calc(l - 5%)); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }

.btn-secondary { background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); }
.btn-secondary:hover { background-color: var(--hover-bg); border-color: var(--text-secondary); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

.btn-danger { background-color: var(--danger-color); color: #ffffff; }
.btn-danger:hover { background-color: hsl(from var(--danger-color) h s calc(l - 5%)); }

.btn-close { background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; padding: 5px; line-height: 1; opacity: 0.6; transition: all var(--transition-speed-fast) ease; }
.btn-close:hover { opacity: 1; color: var(--danger-color); transform: scale(1.1); }

/* ==========================================================================
   11. Utility Classes
   ========================================================================== */

.hidden { display: none !important; }
.visually-hidden { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; }
.error-message { color: var(--danger-color); margin: var(--base-padding) 0; text-align: center; font-weight: 500; background-color: rgba(var(--danger-color), 0.1); border: 1px solid rgba(var(--danger-color), 0.3); border-radius: var(--border-radius-small); padding: var(--small-gap) var(--base-padding); display: none; /* Show via JS */ }
.error-message:not(:empty) { display: block; } /* Show if it has content */
